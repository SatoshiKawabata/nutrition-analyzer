# 栄養価計算サンプルアプリ計画

## ゴール
- Supabase 上の日本食品標準成分表データを使い、食品を選んで分量を入力すると主要栄養価の合計を即時計算する最小限の Web アプリを作る。

## 想定ユーザー・ユースケース
- 管理栄養士や食事記録に関心のある一般ユーザーが、単発で食事の栄養価をざっくり確認したい。
- デモ用途なのでユーザー登録は不要。即座に食品検索と合計値確認ができる体験を優先。

## MVP 機能
1. 食品検索（食品名・食品群和名の部分一致、最大 20 件表示）
2. 検索結果から食品を選択し、テーブル行として追加（初期重量 100g を自動入力）
3. テーブルで CSV ヘッダー準拠の栄養素列を表示し、重量入力に応じて各栄養素値を換算表示
4. 行ごとの重量再入力および削除操作
5. テーブル下部（もしくは最終行）で主要栄養素合計をリアルタイム表示

## テーブル UI 要件
- レイアウトは `20230428-mxt_kagsei-mext_00001_012_processed_v2.csv` の 3 段組ヘッダー（大分類・中分類・詳細列）をそのまま再現する。
- 入力行の最左列に食品検索インプットを配置し、入力中は候補ドロップダウン（食品 + 食品群名表示）を展開。
- 候補選択時に Supabase から対象食品の 100g あたり栄養値を取得し、残りセルへ自動反映。
- 重量セルは数値入力（g 単位、小数可）で、変更すると行内の栄養素値を即時計算し直す。
- 新規行追加ボタンで空行（検索インプットのみ有効）を末尾へ追加。未確定行は削除可能。
- 行末に削除ボタンを置き、選択済み食品を取り除くと合計値も再計算。

## 技術スタック（最小構成）
- フロントエンド: Vite + React + TypeScript（クライアントのみで完結）
- UI: Mantine など軽量コンポーネント or 素の CSS（初期は簡素な Tailwind を想定）
- データアクセス: Supabase JavaScript Client（匿名キー使用、RLS は匿名 role に読み取り許可済み前提）
- 環境変数: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`
- デプロイ: Vercel もしくは Netlify（環境変数設定のみで動作）

## データ取得方針
- `foods` テーブルから食品情報を取得（名前・食品コード・廃棄率など）
- `food_nutrient_values` と `nutrient_components` を結合して主要栄養素の値を取得
- 初期ロードでは主要栄養素のコンポーネント ID を定数化しておき、検索時にまとめて取得する簡易 RPC（Supabase Function）を作成するか、クエリで該当栄養素のみ抽出
- 食品検索 API は Supabase の全文検索 (`ilike`) を活用し、limit/pagination でレスポンスを制御

## フロントエンド構成案
- `App` コンポーネント: ルート（単一ページ）
- `NutritionTable` コンポーネント: CSV ヘッダー準拠のテーブル描画、行追加・削除・重量入力管理
- `FoodSearchInput` コンポーネント: オートコンプリート付き検索欄（テーブル各行に埋め込み）
- `TableFooterSummary` コンポーネント: 主要栄養素の合計行表示
- 状態管理は React hooks（`useState`, `useMemo`）のみで構築し、行配列と栄養素辞書を効率的にキャッシュ
- 栄養計算は「食品の 100g 当たり栄養値 × (入力量 / 100)」で算出し、表示時は小数第 1 位で丸め

## 画面遷移と UX
- SPA 1 画面構成。テーブルヘッダーは常時表示し、初期状態では入力可能な空行を 1 行表示
- 行最左セルの入力はフォーカス時に候補ポップアップを開き、キーボード操作で選択可能にする
- 食品追加後は同一行に重量 100g を表示し、ユーザー操作で即変更可能
- 合計行はテーブルフッターとして固定表示し、スクロールしても見失わない設計を検討
- API 通信中はスピナー表示、結果なしの場合はメッセージ表示

## 想定スクラッチタスク
1. プロジェクト雛形作成（Vite React TypeScript）
2. Supabase クライアント設定と主要テーブルの型定義
3. CSV ヘッダー構造を Supabase/ローカル定義から取得し、テーブルカラム定義を生成
4. 食品検索 API 実装と `FoodSearchInput` のオートコンプリート連携
5. テーブル行状態管理（追加・削除・重量変更）と栄養価換算ロジックの組み込み
6. 合計行計算と固定フッターレイアウト
7. 軽微なスタイリング・UX 調整（横スクロール対応含む）
8. 環境変数テンプレートと README 更新（セットアップ手順）

## 将来拡張の余地（MVP 外）
- 栄養素フィルタリング・カテゴリ表示
- 食事履歴保存（Supabase Auth + ログ保存）
- CSV / PDF 出力
- 一日の目標摂取量との比較・アラート表示
- 主要栄養素以外（ビタミン・ミネラル等）の詳細表示
